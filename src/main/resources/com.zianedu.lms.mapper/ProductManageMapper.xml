<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zianedu.lms.mapper.ProductManageMapper">

	<select id="selectVideoList" resultType="VideoListDTO">
		SELECT A.G_KEY, A.NAME as GOODS_NANE, A.INDATE, A.IS_SHOW, A.IS_SELL, A.IS_FREE, D.NAME as TEACHER_NAME, E.STATUS
		FROM T_GOODS A LEFT JOIN T_GOODS_TEACHER_LINK B
		ON A.G_KEY = B.G_KEY
		LEFT JOIN T_TEACHER C
		ON B.TEACHER_KEY = C.TEACHER_KEY
		LEFT JOIN T_USER D
		ON C.USER_KEY = D.USER_KEY
		LEFT JOIN T_LEC E
		ON A.G_KEY = E.G_KEY
		WHERE 1=1
		AND A.TYPE = 1
		ORDER BY A.G_KEY DESC
		<if test="searchType eq 'code'">
			AND A.G_KEY = #{searchText}
		</if>
		<if test="searchType eq 'title'">
			AND A.NAME LIKE '%'||#{searchText}||'%'
		</if>
		ORDER BY A.G_KEY DESC
		OFFSET #{startNumber} ROWS FETCH NEXT #{listLimitNumber} ROWS ONLY
	</select>

	<select id="selectTGoodsInfo" parameterType="Integer" resultType="com.zianedu.lms.vo.TGoodsVO">
		SELECT * FROM T_GOODS WHERE G_KEY = #{gKey}
	</select>

	<select id="selectTGoodsPriceOptionList" resultType="com.zianedu.lms.vo.TGoodsPriceOptionVO">
		SELECT * FROM T_GOODS_PRICE_OPTION WHERE G_KEY = #{gKey}
	</select>

	<select id="selectTCategoryGoodsList" parameterType="Integer" resultType="com.zianedu.lms.vo.TCategoryGoods">
		SELECT * FROM T_CATEGORY_GOODS WHERE G_KEY = #{gKey}
	</select>

	<select id="selectTLecInfo" parameterType="Integer" resultType="com.zianedu.lms.vo.TLecVO">
		SELECT * FROM T_LEC WHERE G_KEY = #{gKey}
	</select>

	<select id="selectTeacherListByTeacherLink" parameterType="Integer" resultType="com.zianedu.lms.vo.TGoodTeacherLinkVO">
		SELECT A.*, B.name as subject_name, D.name as teacher_name
		FROM T_GOODS_TEACHER_LINK A
		LEFT JOIN T_CATEGORY B
		ON A.SUBJECT_CTG_KEY = B.CTG_KEY
		LEFT JOIN T_TEACHER C
		ON C.TEACHER_KEY = A.TEACHER_KEY
		INNER JOIN T_USER D
		ON D.USER_KEY = C.USER_KEY
		WHERE A.G_KEY = #{gKey}
	</select>

	<select id="selectTGoodsFromTLinkKeyRel" resultType="com.zianedu.lms.vo.TLinkKeyVO">
		SELECT A.*, B.name as goods_name
		FROM T_LINK_KEY A INNER JOIN T_GOODS B
		ON A.res_key = B.g_key
		WHERE A.req_key = #{reqKey}
		<if test="resType > 0 and resType != null">
			AND A.res_type = #{resType}
		</if>
	</select>

	<select id="selectTExamMasterFromTLinkKeyRel" resultType="com.zianedu.lms.vo.TLinkKeyVO">
		SELECT A.*, B.name as goods_name
		FROM T_LINK_KEY A INNER JOIN T_EXAM_MASTER B
		ON A.res_key = B.exam_key
		WHERE A.req_key = #{reqKey}
		<if test="resType > 0 and resType != null">
			AND A.res_type = #{resType}
		</if>
	</select>

	<select id="selectTLecCurriList" parameterType="Integer" resultType="com.zianedu.lms.vo.TLecCurri">
		SELECT * FROM T_LEC_CURRI WHERE LEC_KEY = #{lecKey} ORDER BY POS ASC
	</select>

	<select id="selectTLinkKeyList" parameterType="Integer" resultType="com.zianedu.lms.vo.TLinkKeyVO">
		SELECT * FROM T_LINK_KEY WHERE req_key = #{reqKey}
	</select>

	<insert id="insertTGoods" parameterType="com.zianedu.lms.vo.TGoodsVO">
		INSERT INTO T_GOODS
		(
			G_KEY, C_KEY, CP_KEY, NAME, INDATE, SELLSTARTDATE, TYPE, IS_SHOW, IS_SELL, IS_FREE, IS_NODC, IMAGE_LIST, IMAGE_VIEW,
			EMPHASIS, TAGS, SUMMARY, DESCRIPTION, CALCULATE_RATE, IS_FREEBIE_DELIVERY_FREE, IS_QUICK_DELIVERY, GOODS_ID
		)
		VALUES
		(
			T_GOODS_SEQ.NEXTVAL, #{cKey}, #{cpKey}, #{name}, #{indate}, #{sellstartdate}, #{type}, #{isShow}, #{isSell}, #{isFree}, #{isNodc}, #{imageList}, #{imageView},
			#{emphasis}, #{tags}, #{summary}, #{description}, #{calculateRate}, #{isFreebieDeliveryFree}, #{isQuickDelivery}, #{goodsId}
		)
		<selectKey resultType="Integer" keyProperty="gKey" order="BEFORE">
			SELECT T_GOODS_SEQ.NEXTVAL FROM DUAL
		</selectKey>
	</insert>

	<insert id="insertTGoodsPriceOption" parameterType="com.zianedu.lms.vo.TGoodsPriceOptionVO">
		INSERT INTO T_GOODS_PRICE_OPTION
		(
			PRICE_KEY, G_KEY, KIND, CTG_KEY, NAME, PRICE, SELL_PRICE, POINT, EXTEND_PERCENT
		)
		VALUES
		(
			T_GOODS_PRICE_OPTION_SEQ.nextval, #{gKey}, #{kind}, "", "", #{price}, #{sellPrice}, #{point}, #{extendPercent}
		)
		<selectKey resultType="Integer" keyProperty="priceKey" order="BEFORE">
			SELECT T_GOODS_PRICE_OPTION_SEQ.NEXTVAL FROM DUAL
		</selectKey>
	</insert>

	<insert id="insertTCategoryGoods" parameterType="com.zianedu.lms.vo.TCategoryGoods">
		INSERT INTO T_CATEGORY_GOODS
		(
			CTG_G_KEY, CTG_KEY, G_KEY, POS
		)
		VALUES
		(
			T_CATEGORY_GOODS_SEQ.nextval, #{ctgKey}, #{gKey}, #{pos}
		)
	</insert>

	<insert id="insertTLec" parameterType="com.zianedu.lms.vo.TLecVO">
		INSERT INTO T_LEC
		(
			LEC_KEY, G_KEY, TEACHER_KEY, CLASS_GROUP_CTG_KEY, SUBJECT_CTG_KEY, STEP_CTG_KEY, STATUS, REGDATE, STARTDATE,
			LIMIT_DAY, LIMIT_COUNT, LEC_TIME, MULTIPLE, LEC_DATE_YEAR, LEC_DATE_MONTH, EXAM_YEAR, IS_PACK, GOODS_ID
		)
		VALUES
		(
			T_LEC_SEQ.nextval, #{gKey}, #{teacherKey}, #{classGroupCtgKey}, #{subjectCtgKey}, #{stepCtgKey}, #{status}, #{regdate}, #{startdate},
			#{limitDay}, #{limitCount}, #{lecTime}, #{multiple}, #{lecDateYear}, #{lecDateMonth}, #{examYear}, #{isPacek}, #{goodsId}
		)
		<selectKey resultType="Integer" keyProperty="lecKey" order="BEFORE">
			SELECT T_LEC_SEQ.nextval FROM DUAL
		</selectKey>
	</insert>

	<insert id="insertTGoodsTeacherLink" parameterType="com.zianedu.lms.vo.TGoodTeacherLinkVO">
		INSERT INTO T_GOODS_TEACHER_LINK
		(
			G_TEACHER_KEY, G_KEY, IS_PUBLIC_SUBJECT, SUBJECT_CTG_KEY, TEACHER_KEY, CALCULATE_RATE
		)
		VALUES
		(
			T_GOODS_TEACHER_LINK_SEQ.nextval, #{gKey}, #{isPublicSubject}, #{subjectCtgKey}, #{teacherKey}, #{calculateRate}
		)
	</insert>

	<insert id="insertTLinkKey" parameterType="com.zianedu.lms.vo.TLinkKeyVO">
		INSERT INTO T_LINK_KEY
		(
			LINK_KEY, REQ_KEY, RES_KEY, REQ_TYPE, RES_TYPE, POS, VALUE_BIT
		)
		VALUES
		(
			T_LINK_KEY_SEQ.nextval, #{reqKey}, #{resKey}, #{reqType}, #{resType}, 0, #{valueBit}
		)
	</insert>

	<insert id="insertTLecCurri" parameterType="com.zianedu.lms.vo.TLecCurri">
		INSERT INTO
	</insert>

	<update id="updateTGoods" parameterType="com.zianedu.lms.vo.TGoodsVO">
		UPDATE T_GOODS
		<set>
			<if test="cpKey > 0">CP_KEY = #{cpKey},</if>
			<if test="name != '' or name != null">NAME = #{name},</if>
			<if test="indate != '' or indate != null">INDATE = #{indate},</if>
			<if test="sellstartdate != '' or indate != null">SELLSTARTDATE = #{sellstartdate},</if>
			<if test="type != null">TYPE = #{type},</if>
			<if test="isShow != null">IS_SHOW = #{isShow},</if>
			<if test="isSell != null">IS_SELL = #{isSell},</if>
			<if test="isFree != null">IS_FREE = #{isFree},</if>
			<if test="isNodc != null">IS_NODC = #{isNodc},</if>
			<if test="imageList != '' or imageList != null">IMAGE_LIST = #{imageList},</if>
			<if test="imageView != '' or imageView != null">IMAGE_VIEW = #{imageView},</if>
			<if test="emphasis != null">EMPHASIS = #{emphasis},</if>
			<if test="tags != '' or tags != null">TAGS = #{tags},</if>
			<if test="summary != '' or summary != null">SUMMARY = #{summary},</if>
			<if test="description != '' or description != null">DESCRIPTION = #{description},</if>
			<if test="calculateRate != null">CALCULATE_RATE = #{calculateRate},</if>
			<if test="isFreebieDeliveryFree != null">IS_FREEBIE_DELIVERY_FREE = #{isFreebieDeliveryFree},</if>
			<if test="isQuickDelivery != null">IS_QUICK_DELIVERY = #{isQuickDelivery},</if>
			<if test="goodsId != null">GOODS_ID = #{goodsId},</if>
		</set>
		WHERE G_KEY = #{gKey}
	</update>

	<update id="updateTGoodsPriceOption" parameterType="com.zianedu.lms.vo.TGoodsPriceOptionVO">
		UPDATE T_GOODS_PRICE_OPTION
		<set>
			<if test="gKey > 0">G_KEY = #{gKey},</if>
			<if test="kind != null ">KIND = #{kind},</if>
			<if test="price != null">PRICE = #{price},</if>
			<if test="sellPrice != null">SELL_PRICE = #{sellPrice},</if>
			<if test="point != null">POINT = #{point},</if>
			<if test="extendPercent != null">EXTEND_PERCENT = #{extendPercent},</if>
		</set>
		WHERE PRICE_KEY = #{priceKey}
	</update>

	<update id="updateTLec" parameterType="com.zianedu.lms.vo.TLecVO">
		UPDATE T_LEC
		<set>
			<if test="gKey > 0">G_KEY = #{gKey},</if>
			<if test="teacherKey != null">TEACHER_KEY = #{teacherKey},</if>
			<if test="classGroupCtgKey != null">CLASS_GROUP_CTG_KEY = #{classGroupCtgKey},</if>
			<if test="subjectCtgKey != null">SUBJECT_CTG_KEY = #{subjectCtgKey},</if>
			<if test="stepCtgKey != null">STEP_CTG_KEY = #{stepCtgKey},</if>
			<if test="status != null">STATUS = #{status},</if>
			<if test="regdate != null or regdate != ''">REGDATE = #{regdate},</if>
			<if test="startdate != null or startdate != ''">STARTDATE = #{startdate},</if>
			<if test="limitDay != null">LIMIT_DAY = #{limitDay},</if>
			<if test="limitCount != null">LIMIT_COUNT = #{limitCount},</if>
			<if test="lecTime != null">LEC_TIME = #{lecTime},</if>
			<if test="multiple != null">MULTIPLE = #{multiple},</if>
			<if test="lecDateYear != null">LEC_DATE_YEAR = #{lecDateYear},</if>
			<if test="lecDateMonth != null">LEC_DATE_MONTH = #{lecDateMonth},</if>
			<if test="examYear != null">EXAM_YEAR = #{examYear},</if>
			<if test="isPack != null">IS_PACK = #{isPack},</if>
			<if test="goodsId != null">GOODS_ID = #{goodsId},</if>
		</set>
		WHERE LEC_KEY = #{lecKey}
	</update>

	<update id="updateTGoodsTeacherLink" parameterType="com.zianedu.lms.vo.TGoodTeacherLinkVO">
		UPDATE T_GOODS_TEACHER_LINK
		<set>
			<if test="isPublicSubject != null">IS_PUBLIC_SUBJECT = #{isPublicSubject},</if>
			<if test="subjectCtgKey != null">SUBJECT_CTG_KEY = #{subjectCtgKey},</if>
			<if test="teacherKey != null">TEACHER_KEY = #{teacherKey},</if>
			<if test="calculateRate != null">CALCULATE_RATE = #{calculateRate},</if>
		</set>
		WHERE G_TEACHER_KEY = #{gTeacherKey}
	</update>

	<update id="updateTLinkKey" parameterType="com.zianedu.lms.vo.TLinkKeyVO">
		UPDATE T_LINK_KEY
		<set>
			<if test="reqKey > 0">REQ_KEY = #{reqKey},</if>
			<if test="resKey > 0">RES_KEY = #{resKey},</if>
			<if test="reqType > 0">RES_TYPE = #{reqType},</if>
			<if test="resType > 0">RES_TYPE = #{resType},</if>
			<if test="valueBit > 0">VALUE_BIT = #{valueBit},</if>
		</set>
		WHERE LINK_KEY = #{linkKey}
	</update>

	<delete id="deleteTCategoryGoods" parameterType="Integer">
		DELETE FROM T_CATEGORY_GOODS WHERE G_KEY = #{gKey}
	</delete>

	<delete id="deleteTLinkKey" parameterType="Integer">
		DELETE FROM T_LINK_KEY WHERE REQ_KEY = #{reqKey}
	</delete>

</mapper>
